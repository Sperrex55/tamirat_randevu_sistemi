{% extends "base_user.html" %}
{% block title %}Randevu DÃ¼zenle{% endblock %}

{% block content %}
<div class="container mt-5" style="max-width: 650px;">
  <h2 class="mb-4">ğŸ“… Randevu DÃ¼zenle</h2>

  <form method="POST" novalidate id="editAppointmentForm">
    <div class="mb-3">
      <label for="date" class="form-label">Tarih ve Saat</label>
      <input type="datetime-local" class="form-control" name="date" id="date" required
             value="{{ appointment.date.strftime('%Y-%m-%dT%H:%M') }}">
      <div class="invalid-feedback">LÃ¼tfen geÃ§erli bir tarih ve saat seÃ§in.</div>
    </div>

    <div class="mb-3">
      <label for="uzmanlik" class="form-label">UzmanlÄ±k</label>
      <select class="form-select" name="uzmanlik" id="uzmanlik" required>
        <option value="" disabled>SeÃ§iniz...</option>
        <option value="Bilgisayar Teknik Servisi" {% if appointment.uzmanlik == 'Bilgisayar Teknik Servisi' %}selected{% endif %}>Bilgisayar Teknik Servisi</option>
        <option value="AÄŸ ve Sistem YÃ¶netimi" {% if appointment.uzmanlik == 'AÄŸ ve Sistem YÃ¶netimi' %}selected{% endif %}>AÄŸ ve Sistem YÃ¶netimi</option>
        <option value="Mobil Cihaz Tamiri" {% if appointment.uzmanlik == 'Mobil Cihaz Tamiri' %}selected{% endif %}>Mobil Cihaz Tamiri</option>
        <option value="YazÄ±lÄ±m GeliÅŸtirme & Teknik Destek" {% if appointment.uzmanlik == 'YazÄ±lÄ±m GeliÅŸtirme & Teknik Destek' %}selected{% endif %}>YazÄ±lÄ±m GeliÅŸtirme & Teknik Destek</option>
      </select>
      <div class="invalid-feedback">LÃ¼tfen uzmanlÄ±k alanÄ± seÃ§in.</div>
    </div>

    <div class="mb-3">
      <label for="category" class="form-label">Kategori</label>
      <select class="form-select" name="category" id="category" required>
        <option value="" disabled>SeÃ§iniz...</option>
        <option value="tamirat" {% if appointment.category == 'tamirat' %}selected{% endif %}>Tamirat</option>
        <option value="tadilat" {% if appointment.category == 'tadilat' %}selected{% endif %}>Tadilat</option>
        <option value="bakim" {% if appointment.category == 'bakim' %}selected{% endif %}>BakÄ±m</option>
        <option value="yazilim" {% if appointment.category == 'yazilim' %}selected{% endif %}>YazÄ±lÄ±m</option>
      </select>
      <div class="invalid-feedback">LÃ¼tfen kategori seÃ§in.</div>
    </div>

    <div class="mb-3">
      <label for="description" class="form-label">AÃ§Ä±klama</label>
      <textarea class="form-control" name="description" id="description" rows="4" maxlength="500" required>{{ appointment.description }}</textarea>
      <div class="form-text"><span id="charCount">0</span>/500 karakter</div>
      <div class="invalid-feedback">LÃ¼tfen aÃ§Ä±klama girin.</div>
    </div>

    <button type="submit" class="btn btn-primary">Kaydet</button>
    <a href="{{ url_for('user_appointments') }}" class="btn btn-secondary ms-2">Ä°ptal</a>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script>
  (() => {
    const form = document.getElementById('editAppointmentForm');
    const description = document.getElementById('description');
    const charCount = document.getElementById('charCount');
    const dateInput = document.getElementById('date');

    // Karakter sayacÄ±
    const updateCharCount = () => {
      charCount.textContent = description.value.length;
    };
    updateCharCount();
    description.addEventListener('input', updateCharCount);

    // Minimum tarih ve saat bugÃ¼nden itibaren
    const now = new Date();
    const pad = n => n.toString().padStart(2, '0');
    const localDatetime = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;
    dateInput.min = localDatetime;

    // Bootstrap form validation
    form.addEventListener('submit', function(e) {
      if (!form.checkValidity()) {
        e.preventDefault();
        e.stopPropagation();
        form.classList.add('was-validated');
      }
    });
  })();
</script>
{% endblock %}
